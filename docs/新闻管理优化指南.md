# 新闻管理优化指南

## 🎯 优化概述

我们已经成功将新闻管理系统从复杂的 `.ts` 文件格式优化为简单的 Markdown 格式，大大简化了新闻的创建和管理流程。

**重要说明**：新闻内容在 AI 页面的 "AI前沿新闻" 标签页中显示，而不是单独的新闻页面。

## 📁 新的目录结构

```
content-repo/news/
├── ai-news/                    # AI新闻
│   ├── 20240101-OpenAIGPT-41.md
│   ├── 20240102-Google-Gemini.md
│   └── 20240103-GLM.md
├── tech-news/                  # 技术新闻
├── industry-news/              # 行业动态
└── 其他分类/
```

## 📝 新闻文件格式

### Front Matter（元数据）
```yaml
---
title: "新闻标题"
description: "新闻摘要描述"
author: "作者名称"
date: "2024-01-01"
image: "图片URL"
link: "原文链接"
category: "ai-news"
tags: ["OpenAI", "GPT", "AI模型"]
featured: true
---
```

### 内容部分
```markdown
# 新闻标题

## 新闻内容

这里是新闻的详细内容，支持：
- **Markdown 语法**
- 代码块
- 图片
- 链接
- 表格

## 技术细节

```javascript
// 示例代码
console.log("Hello, AI News!");
```

## 相关链接

- [官方文档](https://example.com)
- [GitHub仓库](https://github.com/example)

---

*了解更多信息，请访问 [原文链接](https://example.com)*
```

## 🚀 使用方法

### 1. 创建新新闻

1. **选择分类目录**：在 `content-repo/news/` 下选择合适的分类目录
2. **创建文件**：创建新的 `.md` 文件，使用日期+标题的命名格式
3. **编写内容**：按照上述格式编写 Front Matter 和内容
4. **提交更改**：提交到内容仓库

### 2. 文件命名规范

- 格式：`YYYYMMDD-标题.md`
- 示例：`20240101-OpenAI发布GPT-41.md`
- 标题使用英文，避免特殊字符

### 3. 自动同步

- 修改内容仓库后，前端会自动同步
- 无需手动更新 `.ts` 文件
- 支持实时预览和部署

## ✨ 优化优势

### 相比之前的 `.ts` 格式：

| 特性 | 旧格式 (.ts) | 新格式 (.md) |
|------|-------------|-------------|
| 创建难度 | 复杂，需要编辑多个文件 | 简单，只需一个文件 |
| 内容管理 | 分散在多个文件中 | 集中在一个文件中 |
| 版本控制 | 难以跟踪内容变化 | Git 可以完美跟踪 |
| 格式统一 | 需要手动维护格式 | 统一的 Markdown 格式 |
| 编辑体验 | 需要编程知识 | 使用熟悉的 Markdown |
| 自动化 | 需要手动导入和链接 | 完全自动化处理 |

### 具体改进：

1. **简化操作**：
   - ❌ 旧方式：编辑 `news.ts` + 创建 `news-content/xxx.ts` + 导入链接
   - ✅ 新方式：直接编辑 `.md` 文件

2. **内容集中**：
   - ❌ 旧方式：元数据和内容分离
   - ✅ 新方式：元数据和内容在同一文件

3. **版本控制**：
   - ❌ 旧方式：难以跟踪内容变化
   - ✅ 新方式：Git 完美支持

4. **格式统一**：
   - ❌ 旧方式：需要手动维护格式一致性
   - ✅ 新方式：统一的 Markdown 格式

## 🔧 技术实现

### 自动化流程

1. **内容同步**：`fetch-content.js` 从内容仓库同步新闻文件
2. **数据解析**：`build-content.js` 解析 `.md` 文件并生成 `news.json`
3. **前端渲染**：React 组件自动加载和渲染新闻内容

### 文件处理

- **Front Matter 解析**：使用 `gray-matter` 解析 YAML 元数据
- **Markdown 渲染**：使用 `react-markdown` 渲染内容
- **自动分类**：根据文件路径自动分类
- **标签管理**：支持多标签分类和筛选

## 📊 功能特性

### 新闻页面功能

1. **搜索功能**：支持标题和内容搜索
2. **分类筛选**：按新闻分类筛选
3. **标签筛选**：按标签筛选新闻
4. **排序功能**：按日期排序
5. **响应式设计**：支持移动端和桌面端

### 新闻详情页面

1. **完整内容展示**：支持 Markdown 渲染
2. **元信息显示**：作者、日期、分类、标签
3. **原文链接**：直接跳转到原文
4. **返回导航**：便捷的返回功能

## 🎨 样式和主题

### 支持的 Markdown 元素

- **标题**：H1-H6 标题层级
- **文本格式**：粗体、斜体、删除线
- **列表**：有序列表、无序列表
- **链接**：内链和外链
- **图片**：支持图片显示
- **代码**：行内代码和代码块
- **表格**：数据表格
- **引用**：引用块
- **分割线**：水平分割线

### 自定义样式

- 响应式设计
- 暗色主题支持
- 代码高亮
- 图片优化
- 链接样式

## 🔄 迁移指南

### 从旧格式迁移

1. **提取数据**：从 `news.ts` 和 `news-content/` 中提取新闻信息
2. **转换格式**：将内容转换为 Markdown 格式
3. **创建文件**：在 `content-repo/news/` 下创建对应的 `.md` 文件
4. **测试验证**：确保新格式正常工作

### 迁移脚本

我们提供了 `scripts/migrate-news-to-markdown.js` 脚本来帮助迁移：

```bash
node scripts/migrate-news-to-markdown.js
```

## 📈 性能优化

### 加载优化

- 懒加载新闻列表
- 图片懒加载
- 代码分割
- 缓存策略

### 搜索优化

- 客户端搜索
- 实时筛选
- 搜索结果高亮

## 🛠️ 故障排除

### 常见问题

1. **新闻不显示**：
   - 检查文件格式是否正确
   - 确认 Front Matter 格式
   - 验证文件路径

2. **图片不显示**：
   - 检查图片 URL 是否有效
   - 确认图片格式支持

3. **内容渲染错误**：
   - 检查 Markdown 语法
   - 验证特殊字符转义

### 调试工具

- 使用 `scripts/test-news.js` 测试新闻解析
- 检查浏览器控制台错误
- 验证 JSON 数据格式

## 🎯 最佳实践

### 内容编写

1. **标题简洁明了**：使用清晰的标题
2. **描述准确**：提供准确的新闻摘要
3. **标签相关**：使用相关的标签
4. **内容结构**：使用合适的标题层级
5. **链接有效**：确保外部链接有效

### 文件管理

1. **命名规范**：遵循文件命名规范
2. **分类合理**：选择合适的分类目录
3. **版本控制**：及时提交更改
4. **备份重要**：定期备份重要内容

## 🚀 未来扩展

### 计划功能

1. **评论系统**：支持新闻评论
2. **分享功能**：社交媒体分享
3. **订阅功能**：新闻订阅
4. **推荐系统**：智能推荐相关新闻
5. **多语言支持**：国际化支持

### 技术升级

1. **性能优化**：进一步优化加载速度
2. **SEO 优化**：搜索引擎优化
3. **PWA 支持**：渐进式 Web 应用
4. **离线支持**：离线阅读功能

---

## 📞 支持

如果在使用过程中遇到问题，请：

---

# 正文（支持 Markdown/MDX）
```

- 项目 `content/projects/xxx.md`
```yaml
---
title: 项目标题
description: 项目描述
technologies: ["React","TypeScript"]
githubUrl: "https://github.com/..."
demoUrl: "https://demo.example.com"
publishDate: "2025-01-01"
category: "项目分类"
isRecommended: true
isHighlight: false
coverImage: "/images/projects/cover.png"
figmaUrl: "https://www.figma.com/..." # 可选
---

项目详情正文。
```

- 设计 `content/designs/xxx.md`
```yaml
---
title: 设计标题
description: 设计描述
category: "UI/UX"
publishDate: "2025-01-01"
coverImage: "/images/designs/cover.png"
---

设计说明正文。
```

- 视频 `content/videos/xxx.md`
```yaml
---
title: 视频标题
description: 视频简介
category: "教程/演示"
publishDate: "2025-01-01"
videoUrl: "https://www.youtube.com/watch?v=..."
coverImage: "/images/videos/cover.png"
---

视频相关说明。
```

### 四、构建与运行

- `package.json` 脚本
```json
{
  "scripts": {
    "dev": "npm run build:content && vite",
    "build": "npm run build:content && vite build",
    "build:content": "node scripts/build-ai-news.js && node scripts/build-projects.js && node scripts/build-designs.js && node scripts/build-videos.js"
  }
}
```

- 常用命令
```
npm run build:content   # 仅生成 JSON 产物
npm run dev             # 生成产物后启动开发服务器
npm run build           # 生成产物并打包
```

生成成功后终端会输出：
- `生成了 N 条AI新闻`
- `✅ 生成了 X 个项目数据 → src/data/projects/generated-projects.json`
- `✅ 生成了 X 个设计数据 → src/data/designs/generated-designs.json`
- `✅ 生成了 X 个视频数据 → src/data/videos/generated-videos.json`

### 五、前端使用要点（已完成改造）

- 页面/组件改造
  - `src/pages/Designs.tsx`、`src/pages/DesignDetails.tsx`：改为 `useDesigns()`
  - `src/pages/Portfolio.tsx`、`src/pages/ProjectDetails.tsx`：改为 `useProjects()`
  - `src/pages/Videos.tsx`、`src/pages/VideoDetails.tsx`：改为 `useProjects()`（配合 `videoMeta`）
  - `src/components/SearchBar.tsx`：设计搜索改为 `useDesigns()`；项目搜索走 `getAllProjects()`（已接入生成数据）

- 字段适配
  - 统一使用 `coverImage` 作为封面图显示
  - 项目详情优先显示 `content`，无则回退 `description`
  - 设计详情无 `images` 时回退显示 `coverImage`

### 六、清理与历史兼容

- 已移除/不再使用的旧数据文件（建议删除）：
  - `public/data/news.json`
  - `src/data/news.json`

- 旧代码中 `fetch('/data/*.json')` 的方式已改为静态导入 Hook，不再需要 Vite 重新加载公共目录 JSON。

### 七、常见问题排查（Troubleshooting）

- 浏览器未更新内容
  - 请强制刷新（Windows/Linux: `Ctrl+Shift+R`，Mac: `Cmd+Shift+R`）

- 本地构建后页面仍显示旧数据
  - 先 `npm run build:content`，再 `npm run dev`
  - 删除 `node_modules/.vite` 后重启（Vite 缓存）

- 运行 `npm run build:content` 报找不到脚本/模块
  - 确认 `scripts/build-*.js` 是否存在、路径是否正确
  - `package.json` 中 `build:content` 是否包含对应脚本

- 类型错误（TypeScript）
  - 查看 `src/hooks/useContent.ts` 中 `Project`/`Design` 接口是否包含页面使用的可选字段（如 `figmaUrl`, `videoUrl`, `images`）
  - 页面上针对可选字段建议使用可选链或回退值

### 八、扩展与约定

- 新增内容类型的标准步骤
  1) 在 `content/<type>/` 设计 Front Matter
  2) 编写 `scripts/build-<type>.js` 解析并输出 `src/data/<type>/generated-<type>.json`
  3) 在 `src/data/<type>/index.ts` 输出 `default<Type>`
  4) 在 `src/hooks/useContent.ts` 增加 `use<Type>()`
  5) 页面/组件改为使用新的 Hook

- 文件命名建议
  - `YYYYMMDD-Title.md` 或有语义的 `kebab-case.md`
  - 视频示例文件建议将 `your-vide.md` 更名为 `your-video.md`（避免生成的 id 不符合预期）