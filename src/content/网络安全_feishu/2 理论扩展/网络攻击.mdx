---
category: study-net
date: 2025-03-10
excerpt: "\u7F51\u7EDC\u653B\u51FB"
tags:
- "\u7B14\u8BB0"
- "\u7F51\u7EDC\u5B89\u5168"
- "Web\u5B89\u5168"
title: "\u7F51\u7EDC\u653B\u51FB"
---
# 网络攻击

## DNS工作流程

兼有客户端和服务器功能的本地主机工作方式



### 查询方式

*  递归查询：客户机和服务器之间是递归查询 DNS服务器若未能在本地找到相应的信息，就代替用户扮演解析器的角色，直到最后找到结果，若没有结果即返回错误 
*  反复查询：一般服务器之间是反复查询（迭代查询） DNS服务器返回的要么是本地存在的结果信息，要么是一个错误码，然后再返回一个可能会有查询结果的DNS服务器地址 



## 安全威胁

DNS应答包被客户端接受需要满足以下五个条件：

1、应答包的question域和请求包的question域的域名信息一致

2、Transaction ID一致

3、源IP与目标IP地址一致

4、应答包的目的IP地址和端口与请求包的源IP地址和端口一致

5、第一个到达的符合以上四个条件的应答包

DNS的安全漏洞体现在：

1. DNS报文只使用序列号来进行有效性鉴别。 序列号是由客户程序设置并由服务器返回结果，客户程序通过它来确定响应与查询是否匹配
2. 从协议定义上看，在DNS应答报文中可附加信息，该信息可与所请求的信息无直接联系
3. DNS缓存机制



### 安全缺陷

* 单点故障
* 软件实现漏洞 
* 缓冲区溢出
* 拒绝服务



### 恶意攻击

* DNS 欺骗（spoofing）
* 缓存中毒（cache posioning）
* 缓冲区溢出漏洞攻击（buffer overflow attacks）
* 拒绝服务攻击（Denial of service attacks）
* 信息泄露（information disclosure）

DNS下毒攻击流程

缓冲区溢出攻击：

* BING软件的许多版本存在缓冲区溢出漏洞，当攻击者获取了管理员权限时，即可入侵BING所在的主机，并可执行任意指令
* 利用DNS服务器软件存在的漏洞实施攻击，例如特定的输入没有进行严格检查，攻击者构造特定的畸形数据包来对DNS服务器进行缓冲区溢出攻击

缓冲区溢出攻击的危害：

* 更改MX记录、造成邮件被截获、修改或删除
* 更改A记录，将www服务器的域名指向黑客具有的同样www内容的主机
* 利用这台主机作为攻击其他机器的跳板

拒绝服务攻击：

* 利用DNS软件的漏洞，如BIND 9版本，如向运行BIND的设备发送特定的DNS数据包请求，BIND就会自动关闭。攻击者只能使BIND停止提供域名解析服务而不能在服务器上执行任何口令
* 危害：域名无法解析为IP地址，用户无法访问互联网

信息泄露：

背景：BIND软件默认设置允许主机间进行区传送（Zone Transfer） 区传送的主要目的是用于主DNS和辅DNS之间的数据同步，使辅DNS可以从主DNS获得新的数据信息

* 一旦启用区传送，且不做任何限制，很可能造成信息泄露，hacker可获得整个授权域内的所有主机信息，判断主机功能及安全性，从中发现目标进行攻击
* 信息一旦泄露，攻击者可根据它推断出主域名服务器的网络结构，为进一步攻击提供参考依据



## DNS安全防范



### 原则：

1、选择安全的没有缺陷的BIND版本 2、DNS服务器配置安全可靠



### BIND主要有三个版本：

1、BIND 4 2、BIND 8是曾经使用最广的版本，目前一部分DNS服务器仍在使用 3、BIND 9最新版本，全部重新写过



### BIND安全配置

1.  隔离DNS服务器 DNS服务器上不应该再运行其他服务，尤其是允许普通用户登陆，减小攻击者利用其他服务漏洞攻击DNS服务器的概率 
2.  为BIND创建chroot chroot指更改某个进程中所能看到的根目录，即将某进程限制在指定的目录中，保证该进程只能对该目录及其子目录有所动作，从而保证整个服务器的安全。BIND9.x系列版本简化了chroot的创建步骤 
3.  隐藏BIND版本号 只需修改配置文件/etc/name.conf，在options部分添加version声明，将BIND版本号覆盖，当有人请求BIND版本信息时，将返回"I will not tell you" 通过发送特殊的DNS查询包，DNS服务器会返回DNS的版本信息`options{version "I will not tell you"}`
4.  请求限制 拒绝DNS服务器响应任何人的任何请求，修改BIND配置文件的/etc/named.conf，添加响应内容即可 
5.  限制区传送 默认全部开放，若没有限制，DNS服务器允许任何人进行区传送，则网络架构中的主机名、主机ip地址表、路由器名及路由IP表，甚至各主机所在位置和硬件配置信息等情况都容易被入侵者获得 
6.  关闭动态更新 



### DNS其他加固措施

1.  事务签名（TSIG）技术 可防止黑客利用IP欺骗对DNS服务器进行攻击，迫使其进行非法区传送 DNS事务签名分为TSIG（Transaction Signature）与SIG0（SIGnature） 对称式TSIG只有一组客户端与服务器端共享密码，完全信任采用 非对称式SIG0采用非对称密码算法，既有公钥又有私钥，非完全信任采用 
2.  DNSSEC 数据包认证机制的建立和推广 DNSSEC引入了两个全新的资源记录类型：KEY和SIG，允许客户端和域名服务器对任何DNS数据的来源进行验证 主要依靠公钥技术对包含在DNS中的信息创建密码签名，密码签名将通过计算一个哈希值来提供DNS中数据的完整性，并将该哈希值封装进行保护 私钥用来封装哈希值，公钥把哈希值解密出来，即可判断数据的完整性 缺点：产生和校验签名需要占用很多CPU时间，额外的开销会影响服务器的性能，签名后的数据量很大， 加重了互联网的负担 
3.  配置DNS Flood Detector DNS Flood Detector是针对DNS服务器的SYN Flood攻击的检测工具，用于侦测恶意地使用DNS查询功能 监控向服务器查询名称解析的数据，分成守护进程（daemon）和后台（bindsnap）模式 守护进程模式会发出警示，bindsnap模式可得到接近实时的查询状态 



# ARP攻击

嗅探技术是一种常用的收集有用数据信息的网络监听方法，是网络安全攻防技术中很重要的一种

网卡一般有四种接收模式：

1. 广播模式（Broadcast），可接收局域网内目的地址为广播地址的所有数据报
2. 多播模式（Multicast），可以接收目的地址为多播地址的所有数据报
3. 直接模式（Directory），即单播模式（Unicast），只接受目的地址为本地MAC地址的所有数据报
4. 混杂模式（Promiscuous），能够接收通过网卡的所有数据报

ARP地址解析协议

主机设有一个ARP高㏿缓存，存放局域网中主机的IP地 址和MAC地址对。当两台主机进行通信时，通过查询 ARP缓存表来进行IP地址到MAC地址的转换。缓存表中 不存在查找项时，运行ARP广播查找目标主机的MAC地址



## ARP攻击溯源

1.  捕包分析 若在网络内任意一台主机上运行抓包软件，捕获所有到达本机的数据包。如果发现有某个IP不断发送ARP Request请求包，则这台电脑一般就是病毒源 原理：ARP病毒行为方式有两种，一是欺骗网关，二是欺骗网内的所有主机 
2.  使用arp -a命令任意选两台不能上网的主机，在DOS命令窗口下运行arp -a命令 原理：一般情况下网内的主机只和网关通信，正常情况下，一台主机的ARP缓存中应该只有网关的MAC地址，如果有其他主机的MAC地址，说明本地主机和这台主机最后有过数据通信发生 

# 拒绝服务攻击

Denial of Service 



## 典型的DoS攻击

*  Ping of Death     

Ping operates by sending Internet Control Message Protocol (ICMP/ICMP6) Echo Request packets to the  target host and waiting for an ICMP Echo Reply.

*  Teardrop     

A teardrop attack involves sending mangled IP fragments with  overlapping, oversized payloads to the target machine.

​ MTU(maximum transfer unit, 最大传送单位)限制传输数据的包大小，大数据包需要分段，Teardrop攻击就是利用这种分组重组间的漏洞而产生的攻击方式

*  Land攻击     

利用特殊的TCP封包传送至目标主机，使其无法判别而宕机或被迫重新启动

攻击原理：用一个特别的SYN包，它的源地址和目标地址都被设置成某一服务器地址，导致接收服务器向它自己的地址发送SYN-ACK消息，结果这个地址又发回ACK消息并创建一个空连接，被攻击的服务器每接收一个这样的连接都将保留，直至超时。

*  SYN洪水     

**原理**：每个机器都需要为半开连接分配一定的资源，这种半开连接的数量是有限制的；攻击方利用TCP连接三次握手协议，打开大量的半开TCP连接，目标主机不能进一步接受TCP连接，机器就不再接受进来的连接请求。

* 一般半开连接超时后，会被自动清除，所以攻击者的系统发出的SYN包的速度要比目标机器清楚半开连接的速度快
* 任何连接到internet并提供基于TCP的网络服务都可能成为攻击的目标
* 这样的攻击很难跟踪，因为源地址往往不可信且不在线
*  Smurf     

原理：攻击者向一个广播地址发送ICMP Echo请求，并且用受害者的IP地址作为源地址，广播地址网络上的每台机器都响应这些Echo请求，同时向受害者主机发送ICMP Echo-Reply应答，受害者的主机会被这些大量的应答包淹没

受影响的操作系统：大多数操作系统和路由器

*  HTTP洪水 这类攻击会占用大量的HTTP进程，从而耗费大量的系统 资源。最终，会导致系统因不堪重负而崩溃掉 以最典型的HTTP GET FLOOD攻击为例： 1.HTTP GET FLOOD是针对应用服务器上的某个文件，对其进行快速的反复的重复读取操作，从而㐀成服务器的资源减少直至崩溃。 2.HTTP GET FLOOD针对的不仅仅是WEB服务器，还有数据库服务器，大量的HTTP请求产生了大量的数据库查询，可以在几秒之内使数据库停止响应，系统负载升高，最终导致服务器宕机。 



## 传统DoS的简单变化

1.  CC攻击：ChallengeCollapsar     

原理：攻击者控制某些主机不停地发大量数据包给对方服务器造成服务器资源耗尽，一直到宕机崩溃

特点：真实度高；检测困难；防御困难 

1.  慢速攻击：HTTP Post慢速DoS攻击     

对HTTP服务器，先建立一个连接，指定一个比较大的content-length，然后以非常低的速度发包，比如1-10s发一个字节，然后维持住这个连接不断开

分类： 

* Slow headers： Web应用在处理HTTP请求之前都要先接收完所有的HTTP头部，因为HTTP头部中包含了一些Web应用可能用到的重要信息，攻击者利用这点，发起一个HTTP请求，一直不停地发送HTTP头部，消耗服务器的连接和内存资源
* Slow body：攻击者发送一个HTTP POST请求，该请求的Content-Length头部值很大，使得Web服务器或代理认为客户端要发送很大的数据
* Slow read：客户端与服务器建立连接并发送了一个HTTP请求，客户端发送完整的请求给服务器端，然后一直保持这个连接，以很低的速度读取Response，比如很长一段时间客户端不读取任何数据，通过发送Zero Window到服务器，让服务器误以为客户端很忙，直到连接快超时前才读取一个字节，以消耗服务器的连接和内存资源



## DoS检测



### 按检测模式分类的检测方法：

*  基于误用的DDoS检测     

基于误用的DDoS攻击检测是指事先收集已有DDoS攻击的各种特征，然后将当前网络中数据包的特征和各种攻击特征相互比较，如果特征匹配则发现DDoS攻击。

**依赖于攻击特征的选取，一般用于检测利用漏洞型的DDoS攻击**

*  基于异常的DDoS检测 
*  混合模式DDoS检测 



### 按算法部署位置分类的检测方法：

* 源端检测
* 中间网络检测
* 目的端检测
* SDN下的DoS检测



